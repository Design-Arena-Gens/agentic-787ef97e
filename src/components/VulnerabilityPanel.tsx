"use client";

import { ShieldExclamationIcon } from "@heroicons/react/24/solid";
import { useMemo } from "react";
import { vulnerabilityInsights } from "@/data/mock";

export function VulnerabilityPanel() {
  const avgScore =
    vulnerabilityInsights.reduce((acc, item) => acc + item.score, 0) /
    vulnerabilityInsights.length;

  const urgent = useMemo(
    () => vulnerabilityInsights.filter((item) => item.score >= 8),
    []
  );

  return (
    <div className="grid gap-6 lg:grid-cols-[1fr_320px]">
      <div className="space-y-4">
        {vulnerabilityInsights.map((vuln) => (
          <div
            key={vuln.cveId}
            className="glass border border-slate-800/70 p-5 transition hover:border-brand-400/40"
          >
            <div className="flex items-start justify-between gap-4">
              <div>
                <p className="text-xs uppercase text-slate-400">{vuln.cveId}</p>
                <p className="mt-1 text-lg font-semibold text-slate-100">
                  {vuln.description}
                </p>
                <p className="mt-2 text-xs text-slate-400">
                  Vector: {vuln.vector} • Exposure: {vuln.exposure}
                </p>
              </div>
              <div className="text-right">
                <p className="font-semibold text-3xl text-rose-200">
                  {vuln.score.toFixed(1)}
                </p>
                <p className="text-xs text-slate-500">
                  {vuln.affectedAssets} assets
                </p>
              </div>
            </div>
            <div className="mt-4 flex items-center justify-between text-xs text-slate-400">
              <span>
                Remediation ETA:{" "}
                <strong className="text-slate-200">
                  {vuln.remediationEtaHours}h
                </strong>
              </span>
              <button className="rounded-full border border-brand-400/50 px-3 py-1 font-semibold text-brand-200 transition hover:bg-brand-500/20">
                Launch Playbook
              </button>
            </div>
          </div>
        ))}
      </div>
      <aside className="space-y-4">
        <div className="glass border border-slate-800/60 p-5">
          <p className="text-xs uppercase text-slate-400">Risk Posture</p>
          <p className="mt-2 text-4xl font-semibold text-slate-50">
            {avgScore.toFixed(1)}
          </p>
          <p className="mt-3 text-xs text-slate-400">
            Average CVSS score across prioritized vulnerabilities. Automation
            triggers for scores ≥ 8.5.
          </p>
          <div className="mt-4 space-y-2 text-xs text-slate-300">
            {urgent.map((item) => (
              <div
                key={item.cveId}
                className="flex items-center justify-between rounded-xl border border-rose-400/40 bg-rose-500/10 px-3 py-2"
              >
                <span>{item.cveId}</span>
                <span>{item.score.toFixed(1)}</span>
              </div>
            ))}
          </div>
        </div>
        <div className="glass border border-emerald-400/30 bg-emerald-500/10 p-5">
          <div className="flex items-center gap-3">
            <ShieldExclamationIcon className="h-10 w-10 text-emerald-200" />
            <div>
              <p className="text-sm font-semibold text-emerald-50">
                Auto-mitigations
              </p>
              <p className="text-xs text-emerald-100">
                37 endpoints isolated pending network patch cycle.
              </p>
            </div>
          </div>
        </div>
      </aside>
    </div>
  );
}
